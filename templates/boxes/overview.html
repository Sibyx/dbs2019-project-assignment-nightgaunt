{% extends '_layouts/base.html' %}

{% load i18n %}

{% block title %}{% trans 'Boxes' %}{% endblock %}

{#https://stackoverflow.com/questions/42843001/bootstrap-table-wenzhixin-data-by-ajax#}
{#https://stackoverflow.com/questions/33247486/bootstrap-table-json-from-ajax/33247990#}
{#https://github.com/wenzhixin/bootstrap-table/issues/2289#}
{#https://github.com/wenzhixin/bootstrap-table/issues/1236#}


{% block content %}
	<div class="container">

		<div class="row pt-3">
			<div class="col-lg-10">
				<h1>{% trans 'Boxes' %}</h1>
			</div>
			<div class="col-lg-2 text-right">
				<a
					class="btn btn-primary"
					role="button"
					href="{% url 'boxes-add' %}"
					data-toggle="modal"
					data-target="#ajaxModal"
					data-ajax="{% url 'boxes-add' %}"
				>
					<i class="fas fa-plus"></i> {% trans 'Add box' %}
				</a>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<table
					class="table"
					id="dataTable"
					data-toggle="table"
					data-search="true"
					data-ajax="loadTable"
					data-row-attributes="rowAttributes"
					data-side-pagination="server"
					data-pagination="true"
					data-id-field="id"
					data-unique-id="id"
				>
					<thead>
					<tr>
						<th data-field="title">{% trans 'Title' %}</th>
						<th data-field="description">{% trans 'Name' %}</th>
						<th data-field="size">{% trans 'Size' %}</th>
					</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>

	{% include '_partials/modal.html' %}
{% endblock %}

{% block javascript %}
	<script>
		$.ajaxSetup({
			headers: {"X-CSRFToken": '{{csrf_token}}'}
		});

		function loadTable(params) {
			console.log(params);

			$.ajax({
				type: "POST",
				url: "{% url 'boxes-overview' %}",
				dataType: "json",
				success: function (data) {
					console.log(data);

					params.success({
						"rows": data.rows,
						"total": data.items
					})
				},
				error: function (err) {
					params.error(err);
				}
			})
		}

		function rowAttributes(row, index) {
			return {
				'data-url': row.url
			}
		}

		$("#dataTable tbody").on('click', 'tr[data-url]', function (e) {
			window.location = $(this).data('url');
		});
	</script>
{% endblock %}
